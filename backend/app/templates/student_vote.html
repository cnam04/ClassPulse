<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Vote</title>
  <style>
    body { font-family: system-ui, Arial; display:grid; place-items:center; min-height:100vh; }
    .card { padding: 24px; border: 1px solid #ddd; border-radius: 12px; width: 420px; text-align: center; }
    .row { display: flex; gap: 8px; margin-top: 12px; }
    button { flex: 1; padding: 12px 10px; border-radius: 10px; border: 1px solid #ccc; }
    .ok { color: #0a0; margin-top: 10px; }
    .warn { color: #a00; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Session {{ code }}</h1>
    <p>When the teacher calls a vote, tap one option below:</p>
    <div class="row">
      <button data-v="not_confused">Not confused</button>
      <button data-v="soso">So-so</button>
      <button data-v="confused">Confused</button>
    </div>
    <div id="msg"></div>
  </div>

  <script>
    const code = "{{ code }}";
    const msg = document.getElementById('msg');
    for (const btn of document.querySelectorAll('button[data-v]')) {
      btn.addEventListener('click', async () => {
        const status = btn.getAttribute('data-v');
        const res = await fetch(`/api/session/${code}/vote`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ status })
        });
        if (res.ok) {
          const data = await res.json();
          if (data.ok) {
            msg.className = 'ok';
            msg.textContent = 'Vote recorded. Thanks!';
          } else {
            msg.className = 'warn';
            msg.textContent = data.reason || 'Vote not accepted.';
          }
        } else {
          msg.className = 'warn';
          msg.textContent = 'Error sending vote.';
        }
      });
    }
  </script>
</body>
</html>
